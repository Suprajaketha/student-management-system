name: Dispatch and Scheduled Pipeline

on:
  push:
    branches:
      - dev
  workflow_dispatch: # Allows manual triggering of the workflow
  schedule:
    - cron: '50 18 * * *' # This will trigger the workflow every day at 12:20 AM IST (which is 18:50 UTC)

jobs:
  timed-job:
    if: github.ref == 'refs/heads/dev' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Set up time variables
        id: time
        run: |
          current_time=$(date -u +"%H:%M")
          echo "current_time=$(date -u +"%H:%M")" >> $GITHUB_ENV
          scheduled_time="18:50"
          echo "scheduled_time=18:50" >> $GITHUB_ENV

      - name: Check if triggered at the correct time
        run: |
          if [ "$current_time" == "$scheduled_time" ]; then
            echo "The job is running at the scheduled time: $scheduled_time UTC"
          else
            echo "The job was manually triggered or is not running at the scheduled time. Scheduled time is $scheduled_time UTC, current time is $current_time UTC"
          fi
        env:
          current_time: ${{ env.current_time }}
          scheduled_time: ${{ env.scheduled_time }}

      - name: Execute pipeline task
        run: echo "Executing the pipeline task..."
